# Структура тестов для WebSocket компонентов

## socket.adapter.spec.ts
Тесты для SocketAdapter, отвечающего за низкоуровневую работу с Socket.IO.

### Создание сервера
- [ ] Создание с настройками CORS из конфига
- [ ] Создание с дефолтными настройками
- [ ] Проверка всех опций сервера (transports, timeouts, etc.)

### События сервера
- [ ] Обработка connection_error
- [ ] Обработка new_namespace
- [ ] Логирование connect/disconnect

### Очистка ресурсов
- [ ] Отключение всех клиентов при dispose
- [ ] Закрытие сервера при dispose
- [ ] Очистка this.server после dispose

## socket.gateway.spec.ts
Тесты для SocketGateway, отвечающего за бизнес-логику WebSocket взаимодействий.

### Аутентификация
- [x] Отказ в подключении без токена
- [x] Успешное подключение с валидным токеном
- [x] Отказ при невалидном токене
- [x] Отказ при токене несуществующего пользователя

### Управление соединениями
- [x] Добавление клиента в connectedClients при подключении
- [x] Отправка connection:established при подключении
- [x] Broadcast статуса пользователя при подключении
- [x] Удаление из connectedClients при отключении
- [x] Broadcast статуса при отключении
- [x] Очистка слушателей при отключении

### Чат
- [x] Получение существующего чата
- [x] Создание нового чата
- [x] Отправка сообщения (успешная)
- [x] Отправка сообщения (ошибка: не участник чата)
- [x] Присоединение к чату
- [x] Обновление статуса непрочитанных сообщений
- [x] Отметка сообщения как прочитанного
- [x] Broadcast статуса сообщения

### Очистка соединений
- [ ] Очистка неактивных соединений
- [ ] Очистка отключенных соединений
- [ ] Очистка интервала при закрытии
- [ ] Отключение всех сокетов при закрытии
- [ ] Очистка слушателей при закрытии

## socket.integration.spec.ts
Интеграционные тесты для проверки взаимодействия компонентов.

### Полный цикл чата
- [ ] Подключение двух пользователей
- [ ] Создание чата между пользователями
- [ ] Отправка сообщений между пользователями
- [ ] Получение и чтение сообщений
- [ ] Корректное отключение пользователей

### Обработка ошибок
- [ ] Восстановление после сетевых ошибок
- [ ] Переподключение при разрыве соединения
- [ ] Повторная отправка неотправленных сообщений

### Масштабирование
- [ ] Работа с множеством одновременных подключений
- [ ] Обработка большого количества сообщений
- [ ] Очистка неактивных соединений под нагрузкой

## Утилиты для тестирования
- [ ] Создание тестовых пользователей
- [ ] Создание тестовых токенов
- [ ] Эмуляция сетевых ошибок
- [ ] Мокирование сервисов
- [ ] Хелперы для проверки состояния соединений
